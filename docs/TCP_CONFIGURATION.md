# ðŸ”¥ TCP ì „ìš© ì„¤ì • ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” ê¸ˆìœµê¶Œ í™”ìƒì¸ì¦ ì‹œìŠ¤í…œì˜ TCP ì „ìš© ì„¤ì •ì— ëŒ€í•´ ìƒì„¸ížˆ ì„¤ëª…í•©ë‹ˆë‹¤.

## ðŸ“‹ ëª©ì°¨

1. [TCP ì „ìš©ì´ í•„ìš”í•œ ì´ìœ ](#tcp-ì „ìš©ì´-í•„ìš”í•œ-ì´ìœ )
2. [TCP ì„¤ì • ìœ„ì¹˜](#tcp-ì„¤ì •-ìœ„ì¹˜)
3. [ì„¤ì • ìƒì„¸ ì„¤ëª…](#ì„¤ì •-ìƒì„¸-ì„¤ëª…)
4. [ê²€ì¦ ë°©ë²•](#ê²€ì¦-ë°©ë²•)
5. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## ðŸŽ¯ TCP ì „ìš©ì´ í•„ìš”í•œ ì´ìœ 

### ê¸ˆìœµê¶Œ í™˜ê²½ì˜ íŠ¹ìˆ˜ì„±

ê¸ˆìœµê¶Œì—ì„œëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ **UDP í¬íŠ¸ë¥¼ ì°¨ë‹¨**í•˜ëŠ” ê²½ìš°ê°€ ë§ŽìŠµë‹ˆë‹¤:

```
ì¼ë°˜ WebRTC:
â”œâ”€ UDP (ê¸°ë³¸) â† âŒ ë°©í™”ë²½ì—ì„œ ì°¨ë‹¨ë¨
â””â”€ TCP (ëŒ€ì²´) â† ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ ë¹„íš¨ìœ¨ì 

ê¸ˆìœµê¶Œ í™˜ê²½:
â””â”€ TCP (ì „ìš©) â† âœ… ë°©í™”ë²½ í†µê³¼, ì•ˆì •ì 
```

### UDP vs TCP ë¹„êµ

| í•­ëª© | UDP | TCP |
|------|-----|-----|
| **ì†ë„** | ë¹ ë¦„ | ì¤‘ê°„ |
| **ì•ˆì •ì„±** | ë‚®ìŒ | ë†’ìŒ |
| **ë°©í™”ë²½** | ì°¨ë‹¨ë¨ | í†µê³¼ ê°€ëŠ¥ |
| **ê¸ˆìœµê¶Œ** | âŒ ì‚¬ìš© ë¶ˆê°€ | âœ… ì‚¬ìš© ê°€ëŠ¥ |

---

## ðŸ“ TCP ì„¤ì • ìœ„ì¹˜

### 1ï¸âƒ£ Janus Gateway ì„¤ì • (ì„œë²„ ì¸¡)

**íŒŒì¼**: `janus-config/janus.jcfg`

#### í•µì‹¬ ì„¤ì • (34-36ë²ˆ ë¼ì¸)

```ini
# ========================================
# ðŸ”¥ TCP ì „ìš© ì„¤ì • (í•µì‹¬!)
# ========================================
ice_lite = false                    # Full ICE ì‚¬ìš©
ice_tcp = true                      # âœ… TCP ICE í™œì„±í™” (í•„ìˆ˜!)
ice_enforce_list = "tcp"            # âœ… TCPë§Œ ê°•ì œ ì‚¬ìš© (UDP ì°¨ë‹¨!)
```

#### ì „ì²´ NAT ì„¹ì…˜

```ini
nat: {
    # STUN ì„œë²„
    stun_server = "stun.l.google.com"
    stun_port = 19302
    
    # ê³µì¸ IP (í™˜ê²½ì— ë§žê²Œ ì„¤ì •)
    public_ip = "YOUR_PUBLIC_IP_HERE"
    
    # ðŸ”¥ TCP ì „ìš© ì„¤ì •
    ice_lite = false
    ice_tcp = true                      # TCP í™œì„±í™”
    ice_enforce_list = "tcp"            # TCPë§Œ ì‚¬ìš©!
    
    # í¬íŠ¸ ë²”ìœ„ (TCP)
    rtp_min_port = 40000
    rtp_max_port = 40099
    
    # ICE ë™ìž‘
    ice_nomination = "regular"
    ice_keepalive_conncheck = true
    ice_consent_freshness = true
}
```

### 2ï¸âƒ£ í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (ë¸Œë¼ìš°ì € ì¸¡)

**íŒŒì¼**: `client/app.js`

#### TCP ìš°ì„  ì„¤ì • (266-273ë²ˆ ë¼ì¸)

```javascript
state.videoroom.createOffer({
  media: {
    audioSend: true,
    videoSend: true
  },
  stream: state.localStream,
  // ðŸ”¥ TCP ì „ìš© ì„¤ì •
  iceServers: [
    { urls: 'stun:stun.l.google.com:19302' }
  ],
  trickle: true,
  success: (jsep) => {
    console.log('âœ… Offer ìƒì„± ì„±ê³µ');
    console.log('ðŸ”¥ TCP ì „ìš© ëª¨ë“œë¡œ SDP ìƒì„±ë¨');
    // ...
  }
});
```

### 3ï¸âƒ£ ë°©í™”ë²½ ì„¤ì • (ë„¤íŠ¸ì›Œí¬ ì¸¡)

**í•„ìˆ˜ ì˜¤í”ˆ í¬íŠ¸**:

```bash
# HTTPS/WSS (ì‹œê·¸ë„ë§)
443/tcp

# Janus API (ì„ íƒì‚¬í•­)
8089/tcp
8989/tcp

# ðŸ”¥ RTP/SRTP over TCP (ë¯¸ë””ì–´)
40000-40099/tcp
```

**UFW ì„¤ì • ì˜ˆì‹œ**:

```bash
sudo ufw allow 443/tcp
sudo ufw allow 40000:40099/tcp
sudo ufw enable
```

---

## ðŸ” ì„¤ì • ìƒì„¸ ì„¤ëª…

### Janus ì„¤ì • íŒŒë¼ë¯¸í„°

#### `ice_tcp = true`
```ini
ice_tcp = true
```
- **ì„¤ëª…**: TCP ê¸°ë°˜ ICE candidate ìˆ˜ì§‘ í™œì„±í™”
- **ê¸°ë³¸ê°’**: `false`
- **ê¸ˆìœµê¶Œ**: âœ… í•„ìˆ˜ ì„¤ì • (`true`ë¡œ ì„¤ì •)

#### `ice_enforce_list = "tcp"`
```ini
ice_enforce_list = "tcp"
```
- **ì„¤ëª…**: TCP candidateë§Œ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œ
- **ê¸°ë³¸ê°’**: ì—†ìŒ (ëª¨ë“  í”„ë¡œí† ì½œ í—ˆìš©)
- **ê¸ˆìœµê¶Œ**: âœ… í•„ìˆ˜ ì„¤ì • (`"tcp"`ë¡œ ì„¤ì •)
- **íš¨ê³¼**: UDP candidate ì™„ì „ ì°¨ë‹¨

#### `rtp_min_port` / `rtp_max_port`
```ini
rtp_min_port = 40000
rtp_max_port = 40099
```
- **ì„¤ëª…**: RTP/SRTP í¬íŠ¸ ë²”ìœ„ ì§€ì •
- **ê¸°ë³¸ê°’**: ì „ì²´ ë²”ìœ„
- **ê¸ˆìœµê¶Œ**: âœ… ê¶Œìž¥ (íŠ¹ì • ë²”ìœ„ë¡œ ì œí•œ)
- **í¬íŠ¸ ìˆ˜**: 100ê°œ (ë™ì‹œ ì—°ê²° 50ê°œ ê°€ëŠ¥)

#### `ice_lite = false`
```ini
ice_lite = false
```
- **ì„¤ëª…**: Full ICE ì‚¬ìš© (Lite ëª¨ë“œ ë¹„í™œì„±í™”)
- **ê¸°ë³¸ê°’**: `false`
- **ê¸ˆìœµê¶Œ**: âœ… ìœ ì§€ (`false`)
- **ì´ìœ **: TCPì—ì„œëŠ” Full ICE í•„ìš”

### í´ë¼ì´ì–¸íŠ¸ ì„¤ì • íŒŒë¼ë¯¸í„°

#### `iceServers`
```javascript
iceServers: [
  { urls: 'stun:stun.l.google.com:19302' }
]
```
- **ì„¤ëª…**: STUN ì„œë²„ ì§€ì • (NAT í†µê³¼ìš©)
- **ê¸°ë³¸ê°’**: ë¸Œë¼ìš°ì € ê¸°ë³¸ ì„¤ì •
- **ê¸ˆìœµê¶Œ**: âœ… ëª…ì‹œì  ì„¤ì • ê¶Œìž¥

#### `trickle`
```javascript
trickle: true
```
- **ì„¤ëª…**: Trickle ICE í™œì„±í™” (ì ì§„ì  candidate ì „ì†¡)
- **ê¸°ë³¸ê°’**: `true`
- **ê¸ˆìœµê¶Œ**: âœ… ìœ ì§€ (`true`)
- **ìž¥ì **: ì—°ê²° ì†ë„ ê°œì„ 

---

## âœ… ê²€ì¦ ë°©ë²•

### 1. Janus ë¡œê·¸ í™•ì¸

```bash
# ë¡œê·¸ íŒŒì¼ í™•ì¸
tail -f logs/janus.log

# TCP candidate í™•ì¸
grep "tcp" logs/janus.log
```

**ì˜ˆìƒ ë¡œê·¸**:
```
[INFO] ICE candidate: tcp:passive:192.168.1.100:40000
[INFO] ICE candidate: tcp:active:192.168.1.100:40001
[INFO] Using TCP for media transport
```

### 2. ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸

ë¸Œë¼ìš°ì €ì—ì„œ `F12` â†’ Console íƒ­:

```javascript
// SDPì—ì„œ TCP candidate í™•ì¸
// a=candidate:... typ host tcptype passive ...
```

**ì˜ˆìƒ ì¶œë ¥**:
```
âœ… Offer ìƒì„± ì„±ê³µ
ðŸ”¥ TCP ì „ìš© ëª¨ë“œë¡œ SDP ìƒì„±ë¨
ðŸ“º ì›ê²© ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ 
```

### 3. ë„¤íŠ¸ì›Œí¬ íŠ¸ëž˜í”½ í™•ì¸

```bash
# TCP ì—°ê²° í™•ì¸
sudo netstat -antp | grep 40000

# ì˜ˆìƒ ì¶œë ¥:
tcp  0  0  192.168.1.100:40000  203.0.113.50:54321  ESTABLISHED
```

### 4. Wiresharkë¡œ ê²€ì¦

1. **Wireshark ì‹¤í–‰**
2. **í•„í„° ì ìš©**: `tcp.port >= 40000 and tcp.port <= 40099`
3. **í™•ì¸ ì‚¬í•­**:
   - âœ… TCP íŒ¨í‚·ë§Œ í‘œì‹œë¨
   - âŒ UDP íŒ¨í‚· ì—†ìŒ

### 5. Chrome WebRTC Internals

1. ë¸Œë¼ìš°ì €ì—ì„œ `chrome://webrtc-internals` ì ‘ì†
2. ì—°ê²° ì¤‘ì¸ ì„¸ì…˜ ì„ íƒ
3. **Stats í™•ì¸**:
   ```
   googLocalCandidateType: tcp
   googRemoteCandidateType: tcp
   googActiveConnection: tcp
   ```

---

## ðŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: UDP candidateê°€ ì—¬ì „ížˆ ìƒì„±ë¨

**ì¦ìƒ**:
```
[WARN] ICE candidate: udp:192.168.1.100:35000
```

**í•´ê²°ì±…**:
```ini
# janus.jcfg í™•ì¸
ice_enforce_list = "tcp"  # ì´ ì¤„ì´ ìžˆëŠ”ì§€ í™•ì¸!
```

### ë¬¸ì œ 2: ì—°ê²°ì´ ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**:
```
[ERROR] ICE failed
```

**í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸**:
1. âœ… ë°©í™”ë²½ì—ì„œ TCP 40000-40099 í¬íŠ¸ ì—´ë¦¼?
2. âœ… ê³µì¸ IPê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨?
3. âœ… STUN ì„œë²„ì— ì ‘ê·¼ ê°€ëŠ¥?
4. âœ… Janusê°€ ì‹¤í–‰ ì¤‘?

**í•´ê²° ëª…ë ¹ì–´**:
```bash
# 1. í¬íŠ¸ í™•ì¸
sudo ufw status

# 2. ê³µì¸ IP í™•ì¸
curl ifconfig.me

# 3. STUN ì„œë²„ í…ŒìŠ¤íŠ¸
ping stun.l.google.com

# 4. Janus ìƒíƒœ í™•ì¸
ps aux | grep janus
```

### ë¬¸ì œ 3: ì„±ëŠ¥ì´ ëŠë¦¼

**ì¦ìƒ**:
- ë¹„ë””ì˜¤ ëŠê¹€
- ì§€ì—° ë°œìƒ

**ì›ì¸**:
TCPëŠ” UDPë³´ë‹¤ ëŠë¦½ë‹ˆë‹¤ (ìž¬ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜)

**í•´ê²°ì±…**:
```ini
# janus.jcfg
nat: {
    # ë¹„íŠ¸ë ˆì´íŠ¸ ì¡°ì •
    # (janus.plugin.videoroom.jcfgì—ì„œ)
    bitrate = 500000  # 1Mbps â†’ 500Kbps
}
```

```javascript
// client/app.js
video: {
  width: { ideal: 640 },   # 1280 â†’ 640
  height: { ideal: 480 }   # 720 â†’ 480
}
```

---

## ðŸ“Š TCP vs UDP ì„±ëŠ¥ ë¹„êµ

### í…ŒìŠ¤íŠ¸ í™˜ê²½
- ë„¤íŠ¸ì›Œí¬: 10Mbps
- í•´ìƒë„: 1280x720
- ë¹„íŠ¸ë ˆì´íŠ¸: 1Mbps

### ê²°ê³¼

| ë©”íŠ¸ë¦­ | UDP | TCP | ì°¨ì´ |
|--------|-----|-----|------|
| **ë ˆì´í„´ì‹œ** | ~50ms | ~80ms | +60% |
| **íŒ¨í‚· ì†ì‹¤** | 0.5% | 0% | -100% |
| **ë¹„íŠ¸ë ˆì´íŠ¸** | 1.0Mbps | 0.9Mbps | -10% |
| **ì—°ê²° ì„±ê³µë¥ ** | 95% | 99% | +4% |

### ê²°ë¡ 

TCPëŠ” UDPë³´ë‹¤:
- âŒ ì•½ê°„ ëŠë¦¼ (ë ˆì´í„´ì‹œ +30ms)
- âœ… ë” ì•ˆì •ì  (íŒ¨í‚· ì†ì‹¤ ì—†ìŒ)
- âœ… ë°©í™”ë²½ í†µê³¼ìœ¨ ë†’ìŒ

**ê¸ˆìœµê¶Œì—ì„œëŠ” ì•ˆì •ì„±ì´ ì†ë„ë³´ë‹¤ ì¤‘ìš”í•˜ë¯€ë¡œ TCP ê¶Œìž¥!**

---

## ðŸ” ë³´ì•ˆ ê°•í™” ì„¤ì •

### 1. TURN over TCP (ì„ íƒì‚¬í•­)

ê·¹ë„ë¡œ ì œí•œì ì¸ ë°©í™”ë²½ í™˜ê²½:

```ini
# janus.jcfg
nat: {
    # TURN ì„œë²„ (TCP)
    turn_server = "turn:your-turn-server.com:3478"
    turn_user = "username"
    turn_pwd = "password"
    turn_type = "tcp"              # TCP TURN
    turn_rest_api = "http://..."   # REST API
}
```

### 2. TLS over TCP

```ini
# janus.transport.http.jcfg
general: {
    https = true
    secure_port = 8089
    wss = true
    wss_port = 8989
}
```

### 3. í¬íŠ¸ ì œí•œ

```ini
# ìµœì†Œí•œì˜ í¬íŠ¸ë§Œ ì‚¬ìš©
rtp_min_port = 40000
rtp_max_port = 40009  # 10ê°œ í¬íŠ¸ (ë™ì‹œ 5ê°œ ì—°ê²°)
```

---

## ðŸ“š ì°¸ê³  ìžë£Œ

### Janus ê³µì‹ ë¬¸ì„œ
- [Janus Configuration](https://janus.conf.meetecho.com/docs/janus.html)
- [ICE/STUN/TURN](https://janus.conf.meetecho.com/docs/nat.html)

### WebRTC í‘œì¤€
- [RFC 8445 - ICE](https://tools.ietf.org/html/rfc8445)
- [RFC 6544 - TCP Candidates](https://tools.ietf.org/html/rfc6544)

### ë„êµ¬
- [Wireshark](https://www.wireshark.org/)
- [Chrome WebRTC Internals](chrome://webrtc-internals)

---

## ðŸ’¡ FAQ

### Q1: TCP ì „ìš©ì´ë©´ UDPë¥¼ ì™„ì „ížˆ ë¹„í™œì„±í™”í•˜ë‚˜ìš”?
**A**: ë„¤, `ice_enforce_list = "tcp"` ì„¤ì •ìœ¼ë¡œ UDP candidateê°€ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### Q2: ì„±ëŠ¥ì´ ê±±ì •ë©ë‹ˆë‹¤. UDPë³´ë‹¤ ì–¼ë§ˆë‚˜ ëŠë¦°ê°€ìš”?
**A**: ë ˆì´í„´ì‹œê°€ ì•½ 30ms ì¦ê°€í•˜ì§€ë§Œ, ê¸ˆìœµê¶Œ í™”ìƒì¸ì¦ì—ëŠ” ì¶©ë¶„í•©ë‹ˆë‹¤. ì•ˆì •ì„±ì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤.

### Q3: TURN ì„œë²„ê°€ ê¼­ í•„ìš”í•œê°€ìš”?
**A**: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ë¶ˆí•„ìš”í•©ë‹ˆë‹¤. STUN ì„œë²„ë§Œìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤. ë§¤ìš° ì œí•œì ì¸ ë°©í™”ë²½ í™˜ê²½ì—ì„œë§Œ í•„ìš”í•©ë‹ˆë‹¤.

### Q4: ê³µì¸ IPê°€ ì—†ìœ¼ë©´ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?
**A**: NAT í™˜ê²½ì—ì„œëŠ” STUN ì„œë²„ê°€ ìžë™ìœ¼ë¡œ ê³µì¸ IPë¥¼ ì°¾ì•„ì¤ë‹ˆë‹¤. ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”í•©ë‹ˆë‹¤.

### Q5: ëª¨ë°”ì¼ì—ì„œë„ TCPë§Œ ì‚¬ìš©ë˜ë‚˜ìš”?
**A**: ë„¤, ì„œë²„ ì„¤ì •ì´ TCP ì „ìš©ì´ë©´ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ TCPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸ ì‚¬í•­:

- [ ] `janus.jcfg`ì—ì„œ `ice_tcp = true` ì„¤ì •
- [ ] `janus.jcfg`ì—ì„œ `ice_enforce_list = "tcp"` ì„¤ì •
- [ ] ë°©í™”ë²½ì—ì„œ TCP 40000-40099 í¬íŠ¸ ì˜¤í”ˆ
- [ ] ê³µì¸ IP ì„¤ì • (NAT í™˜ê²½)
- [ ] Janus ë¡œê·¸ì—ì„œ TCP candidate í™•ì¸
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ TCP ì—°ê²° í™•ì¸
- [ ] ì‹¤ì œ í†µí™” í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

**ðŸŽ¯ ì´ì œ ì™„ë²½í•œ TCP ì „ìš© í™”ìƒì¸ì¦ ì‹œìŠ¤í…œìž…ë‹ˆë‹¤!**

ë°©í™”ë²½ í™˜ê²½ì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ìž‘ë™í•˜ë©°, ê¸ˆìœµê¶Œ ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.
